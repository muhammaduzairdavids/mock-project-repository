---
title: "**Mock Project Using the Maximov (2021) Amphipod Dataset**"
author: "Muhammad Uzair Davids"
date: "2025-02-20"
output: html_document
---

## **Setting up R**

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
```

## **Loading packages for the analysis**
First, I load the packages I want to use to clean the data set. 

```{r load library}
library(tidyverse) # the main package we will be using to tidy our data
library(tidyr) # for the pivot longer function
library(dplyr) # to rename the columns
library(ggplot2) # to make the pretty graphs at the end
```

--- 

## **Loading the datasets**

The datasets used for this exercise is taken from the paper by [Alexy Maximov 
(2021)](https://doi.org/10.5061/dryad.0zpc866z6) titled: **Population dynamics 
of the glacial relict amphipod *Monoporeia affinis* in a subarctic lake**. 
There are three datasets: `data_environmental.csv` contains the data pertaining 
to the environmental variables, `data_macrzoobenthos.csv` contains data 
pertaining to the abundances of certain groups macrozoobenthos organisms, and
`data_population.csv` contains the data pertaining to the age structure of the 
*Monoporeia* spp. population. 

```{r load dataset}
# environmental data
raw_env <- read.csv(
  "data/data_environmental.csv"
)

# macrzoobenthos abundance data
raw_macro <- read.csv(
  "data/data_macrozoobenthos.csv"
) 

# population abundance data
raw_pop <- read.csv(
  "data/data_population.csv"
)
```

## **Inspect the data**

Now that we've loaded the data sets, lets have a closer look at the variables 
and some of the values they contain.

For a summary of the data sets we can use the `summary()` function. 
 
```{r view data}
# summary of the environmental data set
summary(raw_env)
```

```{r}
# summary of the macrozoobenthos data set
summary(raw_macro)
```

```{r}
# summary of the population data set
summary(raw_pop)
```

We can also use the `head()` and `tail()` functions. `head()` will allow us to 
view the first few rows of the data, whereas `tail()` will allow us to view the 
last few rows.

```{r}
# first few rows of the environmental data
head(raw_env)

# last few rows of the environmental data
tail(raw_env)
```

```{r}
# first few rows of the macrozoobenthos data
head(raw_macro)

# last few rows of the macrozoobenthos data
tail(raw_macro)
```

```{r}
# first few rows of the population data
head(raw_pop)

# last few rows of the population data
tail(raw_pop)
```

---

# **Tidying the data**

The first step of this exercise will be to ensure that the data we're using is
in *tidy format*. Ensuring that our data is in *tidy format* helps to make the 
workflow easier to follow, but also allows for more effective communication and 
reproductibility of research. 

At its simplest *tidy data* is data where:

1. Columns represent variables.

2. Rows are observations.

3. Cells contain only a single value.

4. The data is in *wide format*.

5. There are no gaps in the data. 

It should also be mentioned that these guidelines may not be the only things
which qualify as *tidy data*. The data sets I am using abides by most of these 
guidelines, except for two - it is **not** in *wide format*, and there are data 
missing. 

There are also other steps we can take to tidy the data further, such as 
renaming columns, which may help with the reproducible aspect of this 
assignment.

## **Removing missing and invalid data**

Gaps in data sets are considered to be in violation of *tidy format*. The 
environmental data set contains cells with "No data" values - which we saw 
after using the `head()` function above. To fix this, we will replace the "No data" message with `NA`. 

```{r removing missing data}
raw_env[raw_env == "No data"] <- NA # Replace "No data" with NA
```

## **Removing redundant data**

Currently the macrozoobenthos and population datasets contain data which could
be considered as redundant - the "Mean annual abundance of all macrozoobenthos 
(individuals.m-2)" column is just the sum of mean annual abundance of all the
organisms, and the "Total population abundance (individuals.m-2)" column is the
sum of all age groups in the population - so we will remove them to make 
plotting the data easier. 

```{r remove redundant data}
# remove redundant columns from the macrozoobenthos dataset
raw_macro <- raw_macro %>% select(-`Macrozoobenthos..ind.m.2`)

# remove redundant columns from the population dataset
raw_pop <- raw_pop %>% select(-`N.population..ind.m.2`)
```

## **Rename columns**

Some of the column names in the data set are not easily understood, so I 
will change them to make them easier to understand.

```{r rename columns}
# Rename the environmental data columns
tidy_env <- raw_env %>% rename(
  "Mean Concentration of Chlorophyll-a (µg.L-1)" 
  = Clorophyll.a..microgram.L.1,
  "Standard Error (µg.L-1)" 
  = SE,
  "Mean Near-Bottom Temperature (°C)" 
  = T.mean,
  "Minimum Near-Bottom Temperature (°C)" 
  = T.min,
  "Maximum Near-Bottom Temperature (°C)" 
  = T.max
)

# Rename the macrozoobenthos abundance data columns
tidy_macro <- raw_macro %>% rename(
  "Mean annual abundance of Monoporeia affinis (individuals.m-2)" 
  = Monoporeia..ind.m.2,
  "Mean annual abundance of chironomids (individuals.m-2)" 
  = Chironomidae..ind.m.2,
  "Mean annual abundance of other taxa (individuals.m-2)" 
  = Others..ind.m.2
)

# Rename the population abundance data columns
tidy_pop <- raw_pop %>% rename(
  "Abundance of age group 0+ (individuals.m-2)"
  = N.0...ind.m.2,
  "Abundance of age group 1+ (individuals.m-2)"
  = N.1...ind.m.2,
  "Abundance of age group 2+ (individuals.m-2)"
  = N.2...ind.m.2,
  "Standard error (individuals.m-2)" 
  = SE
)
```

## **Pivot longer**

Currently, our data is in *wide format*, which violates the tidy format 
guidelines. So let's fix that using the `pivot_longer` function from the `tidyr` 
package. This will allow us to convert the data into *long format*.

```{r}
# convert the environmental data to long format
long_env <- tidy_env %>%
  pivot_longer(
    cols = c(
      "Mean Near-Bottom Temperature (°C)",
      "Minimum Near-Bottom Temperature (°C)",
      "Maximum Near-Bottom Temperature (°C)"
    ),
    # Select the columns to pivot
    names_to = "Variable",
    # New column name for previous column headers
    values_to = "Value"
  )      # New column for data values

# convert the macrozoobenthos data to long format
long_macro <- tidy_macro %>%
  pivot_longer(
    cols = c(
      "Mean annual abundance of Monoporeia affinis (individuals.m-2)",
      "Mean annual abundance of chironomids (individuals.m-2)",
      "Mean annual abundance of other taxa (individuals.m-2)"
    ),
    # Select the columns to pivot
    names_to = "Variable",
    # New column name for previous column headers
    values_to = "Value"
  )      # New column for data values

# convert the population data to long format
long_pop <- tidy_pop %>%
  pivot_longer(
    cols = c(
      "Abundance of age group 0+ (individuals.m-2)",
      "Abundance of age group 1+ (individuals.m-2)",
      "Abundance of age group 2+ (individuals.m-2)"
    ),
    # Select the columns to pivot
    names_to = "Variable",
    # New column name for previous column headers
    values_to = "Value"
  )      # New column for data values
```

---

## **Plot the tidied data**
Now that we've converted the data to *long format*, we can consider our data to
be in tidy format - so let's plot it!

```{r stacked bar graph}
ggplot(tidy_pop, aes(x = Date, y = Value, fill = Variable)) +
  geom_bar(stat = "identity") +
  geom_errorbar(
    aes(
      ymin = Value - `Standard error (individuals.m-2)`,
      ymax = Value + `Standard error (individuals.m-2)`
    ),
    position = position_stack(vjust = 0.5),
    width = 0.3
  ) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Stacked Bar Plot", x = "Date", y = "Value") +
  theme_minimal()

```

---
